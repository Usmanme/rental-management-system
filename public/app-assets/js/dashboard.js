let timezone = Intl.DateTimeFormat().resolvedOptions().timeZone; let myObject = { "pending-booking": { fun: "clickChildById", id: "pending-car-tab" }, "total-cars": { fun: "clickChildById", id: "active-car-tab" }, "total-in-active": { fun: "clickChildById", id: "inactive-car-tab" }, "available-cars": { fun: "clickChildById", id: "available-car-tab" }, "active-customer": { fun: "callChildFunction", id: { id: "staff_get_num", callback: "fetch_staff" } }, "new-customer": { fun: "callChildFunction", id: { id: "staff_get_num", callback: "fetch_staff" } }, "total-diary": { fun: "callChildFunction", id: { id: "get_filter", callback: "get_filter_call" } }, "diary-pending": { fun: "callChildFunction", id: { id: "get_filter", callback: "get_filter_call" } }, "diary-review-pending": { fun: "callChildFunction", id: { id: "get_filter", callback: "get_filter_call" } }, "diary-complete": { fun: "callChildFunction", id: { id: "get_filter", callback: "get_filter_call" } }, "incomplete-customer": { fun: "callChildFunction", id: { id: "staff_get_num", callback: "fetch_staff" } }, "inqu-dd": { fun: "callChildFunction", id: { id: "main_ids_get", callback: "get_searched_items" } }, "inpro-dd": { fun: "callChildFunction", id: { id: "main_ids_get", callback: "get_searched_items" } }, "dishonored-dd": { fun: "callChildFunction", id: { id: "main_ids_get", callback: "get_searched_items" } }, "success-dd": { fun: "callChildFunction", id: { id: "main_ids_get", callback: "get_searched_items" } }, "settled-dd": { fun: "callChildFunction", id: { id: "main_ids_get", callback: "get_searched_items" } }, "add-new-customer": { fun: "callChildFunction", id: { id: "not_id", callback: "Add_profile" } }, "add-new-vehicle": { fun: "clickChildByClass", id: "getbluelookup" } }; let activeSection; $(document).on("click", ".pay_frame_info", function (t) { var e = $(this).find(".get-u-data").data("url"); var n = $(this).find(".get-u-data").data("callback"); var a = $(this).find(".get-u-data").attr("id"); var i = $(this).find(".pay_title").text(); var c; if (typeof $(this).data("section") === "undefined") { c = $(this).parent(".box_row").parent(".payment_box").attr("id"); c = c.replace("-section", "") } else { var d = $(this).data("section"); var o = d.split(","); c = checkActiveSection(o) } if (activeSection != c) { loadFrameData(e, a, n) } else { loadData(e, n, a, i) } activeSection = c }); function getDashboardData(r, t = []) { var e = { action: r, timezone: timezone }; if (!jQuery.isEmptyObject(t)) { e = Object.assign(e, t) } var s = "body"; $.ajax({ url: "dashboard-ajax-new.php", method: "POST", data: e, dataType: "JSON", success: function (t) { if (r == "images") { $(".recent_images").empty(); $(".recent_images").html(t.data) } else { if (t.length > 0) { for (var e = 0; e < t.length; e++) { var n = "#" + t[e].key; var a = t[e].value ?? 0; var i = t[e].url; var c = t[e].call_back; var d = t[e].cssclass; $(s).find(n).text(a); $(s).find(n).addClass(d); $(s).find(n).data("url", i); $(s).find(n).data("callback", c) } var o = $(s).find(".get-u-data").first().data("url"); var l = $("#framecontent").attr("src"); if (typeof l === "undefined" || l == "") { activeSection = r; loadFrameData(o) } } } } }) } function checkActiveSection(t) { if (t.length > 0) { if (t.includes(activeSection)) { return activeSection } } return t[0] ?? "" } function loadData(t, e = "", n = "", a = "") { var i = $("#framecontent").attr("src"); let c = extractPathname(t); let d = extractPathname(i); if (c == d) { if (myObject.hasOwnProperty(n)) { doSomething(myObject[n].fun, myObject[n].id, e); return true } sendMessage(String(JSON.stringify({ callBackParent: 1, data: e, txt: a }))) } else { loadFrameData(t) } } function childCallBack(t, e) { if (myObject.hasOwnProperty(t)) { doSomething(myObject[t].fun, myObject[t].id, e) } return true } function doSomething(t, e = "", n = "") { if (typeof window[t] === "function") { window[t](e, n) } else { console.error("function does not exist:", t) } } function loadFrameData(t, e = "", n = "") { $("#framecontent").remove(); var a = '<iframe enablejsapi=1 id="framecontent" src="' + t + '&is_dashboard=1" allowfullscreen></iframe>'; $("#f-result").append(a); if (e != "" && n != "") { let t = document.getElementById("framecontent"); t.onload = function () { childCallBack(e, n) } } } function extractPathname(t) { let e = t.indexOf("//"); let n = t.indexOf("/", e + 2); let a = t.indexOf("?"); let i = n !== -1 ? t.slice(n, a !== -1 ? a : undefined) : "/"; return i } function sendMessage(t) { const e = document.querySelector("iframe"); e.contentWindow.postMessage(t, "*") } function callChildFunction(t = "", e = "") { let n = t.id; let a = t.callback; var i = document.getElementById("framecontent"); var c = i.contentWindow; var d = i.contentDocument || i.contentWindow.document; $(c.document).find("#" + n).val(e); if (i.contentWindow) { c[a]() } else { console.error("Child iframe or function not ready.") } } function clickChildById(e) { const t = document.getElementById("framecontent"); const n = t.contentWindow; $(n.document).ready(function () { var t = $.trim($(n.document).find("#" + e).text()); $(n.document).find('.fleet-tab-cls a[href="#' + e + '-link"]').tab("show"); $(n.document).find(".section-title").text(t + " Fleets"); $(n.document).find("#" + e).click() }) } function clickChildByClass(t) { const e = document.getElementById("framecontent"); const n = e.contentWindow; var a = e.contentDocument || e.contentWindow.document; if (a.readyState == "complete") { $(n.document).ready(function () { $(n.document).find("." + t).click() }) } else { window.setTimeout(clickChildByClass, 500, t) } }
